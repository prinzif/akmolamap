<!-- frontend/components/header.html -->

<!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ (–µ—Å–ª–∏ —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ <head>, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–≤—Ä–µ–¥–∏—Ç) -->
<link rel="stylesheet" href="/assets/header.css" />

<!-- –ú–∏–∫—Ä–æ-fallback —Å—Ç–∏–ª–∏ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ header.css –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è -->
<style>
  #__hdr {position:fixed;left:0;top:0;right:0;z-index:10050;}
  #__hdr .header {background:rgba(9,12,19,.9);color:#fff;border-bottom:1px solid rgba(255,255,255,.12);backdrop-filter:blur(12px) saturate(180%);}
  #__hdr .header-content{max-width:1280px;margin:0 auto;padding:12px 24px;display:grid;grid-template-columns:auto 1fr auto;gap:20px;align-items:center}
  #__hdr .logo{display:inline-flex;gap:12px;color:#fff;text-decoration:none}
  #__hdr .nav-menu{display:flex;gap:8px;flex-wrap:wrap}
  #__hdr .nav-link{display:flex;align-items:center;gap:8px;height:38px;padding:0 14px;border-radius:10px;color:#fff;text-decoration:none}
  #__hdr .dropdown-menu{position:absolute;top:100%;left:0;min-width:220px;background:rgba(20,25,38,.98);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px;box-shadow:0 16px 40px rgba(0,0,0,.4);opacity:0;transform:translateY(6px);pointer-events:none;visibility:hidden}
  #__hdr .nav-item{position:relative}
  #__hdr .nav-item.open>.dropdown-menu{opacity:1;transform:translateY(0);pointer-events:auto;visibility:visible}
  #__hdr #btn-refresh{height:38px;padding:0 14px;border-radius:10px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.1);color:#fff;cursor:pointer}
  #__hdr #status-badge{display:inline-flex;gap:6px;align-items:center;padding:5px 10px;border-radius:999px;background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);font-size:12px;color:#c7f9d4}
  #__hdr #status-badge::before{content:"";width:6px;height:6px;border-radius:50%;background:currentColor;box-shadow:0 0 6px currentColor}
</style>

<!-- –í–ê–ñ–ù–û: –Ω–µ –¥–∞—ë–º placeholder'—É –∫–ª–∞—Å—Å .header, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–æ–π .header -->
<div id="__hdr">
  <header class="header" role="banner" aria-label="–®–∞–ø–∫–∞ —Å–∞–π—Ç–∞">
    <div class="header-content">
      <!-- –õ–æ–≥–æ—Ç–∏–ø -->
      <div class="logo-section">
        <a href="/" class="logo">
          <span class="logo-icon">üõ∞Ô∏è</span>
          <div>
            <div>AkmolaSentinel</div>
            <div class="logo-subtitle">–ê–∫–º–æ–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</div>
          </div>
        </a>
      </div>

      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
      <nav class="nav-menu" aria-label="–ì–ª–∞–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
        <div class="nav-item">
          <a href="/" class="nav-link" id="nav-home"><span>üó∫Ô∏è –ì–ª–∞–≤–Ω–∞—è</span></a>
        </div>

        <div class="nav-item has-dropdown">
          <div class="nav-link" role="button" aria-haspopup="true" aria-expanded="false">
            <span>üå± –í–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã ‚ñº</span>
          </div>
          <div class="dropdown-menu" role="menu">
            <a href="/ndvi" class="dropdown-item" id="nav-ndvi" role="menuitem"><span>üìä NDVI</span></a>
            <a href="/biopar" class="dropdown-item" id="nav-biopar" role="menuitem"><span>üåø BIOPAR</span></a>
          </div>
        </div>

        <div class="nav-item has-dropdown">
          <div class="nav-link" role="button" aria-haspopup="true" aria-expanded="false">
            <span>üõ∞Ô∏è –î–∞–Ω–Ω—ã–µ ‚ñº</span>
          </div>
          <div class="dropdown-menu" role="menu">
            <a href="/api/v1/sentinel/search?bbox=68.0,50.0,74.0,53.5" target="_blank" class="dropdown-item" role="menuitem">
              <span>üîç –ü–æ–∏—Å–∫ Sentinel</span>
            </a>
          </div>
        </div>

        <div class="nav-item has-dropdown">
          <div class="nav-link" role="button" aria-haspopup="true" aria-expanded="false">
            <span>‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞ ‚ñº</span>
          </div>
          <div class="dropdown-menu" role="menu">
            <a href="/api/v1/settings/health" target="_blank" class="dropdown-item" role="menuitem">
              <span>‚ù§Ô∏è Health</span>
            </a>
            <a href="/docs" target="_blank" class="dropdown-item" role="menuitem">
              <span>üìñ API Docs</span>
            </a>
          </div>
        </div>
      </nav>

      <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å -->
      <div style="display:flex;align-items:center;gap:10px">
        <span id="status-badge" class="status-badge" aria-live="polite">–ü—Ä–æ–≤–µ—Ä–∫–∞‚Ä¶</span>
        <button id="btn-refresh" type="button" title="–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>
  </header>
</div>

<script>
  // ----- –î—Ä–æ–ø–¥–∞—É–Ω—ã: –∫–ª–∏–∫, —Ç–∞—á, —Ö–æ–≤–µ—Ä (–¥–µ—Å–∫—Ç–æ–ø), ESC -----
  (function navInteractions() {
    const isPointerFine = window.matchMedia('(hover: hover) and (pointer: fine)').matches;

    // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ
    function closeAll() {
      document.querySelectorAll('.nav-item.open').forEach(n => n.classList.remove('open'));
      document.querySelectorAll('.nav-item > .nav-link[aria-expanded="true"]').forEach(n => n.setAttribute('aria-expanded', 'false'));
    }

    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤
    document.addEventListener('click', (e) => {
      // 1) –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ –≤–Ω—É—Ç—Ä–∏ –º–µ–Ω—é ‚Äî –¥–∞—ë–º –ø–µ—Ä–µ–π—Ç–∏ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
      const linkEl = e.target.closest('a.dropdown-item, a.nav-link');
      if (linkEl && linkEl.closest('.dropdown-menu')) {
        closeAll();
        return; // –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
      }

      // 2) –ö–ª–∏–∫ –ø–æ —Ç–æ–≥–≥–ª–µ—Ä—É –¥—Ä–æ–ø–¥–∞—É–Ω–∞
      const toggler = e.target.closest('.nav-item.has-dropdown > .nav-link');
      if (toggler) {
        const item = toggler.parentElement; // .nav-item
        const wasOpen = item.classList.contains('open');
        closeAll();
        if (!wasOpen) {
          item.classList.add('open');
          toggler.setAttribute('aria-expanded', 'true');
        }
        // –µ—Å–ª–∏ —ç—Ç–æ <a>, –Ω–µ —É–≤–æ–¥–∏–º –ø–æ href="#"
        e.preventDefault();
        e.stopPropagation();
        return;
      }

      // 3) –ö–ª–∏–∫ –≤–Ω–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ‚Äî –∑–∞–∫—Ä—ã—Ç—å
      if (!e.target.closest('.nav-menu')) {
        closeAll();
      }
    }, true);

    // ESC –∑–∞–∫—Ä—ã–≤–∞–µ—Ç
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeAll();
    });

    // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–∞—Ö –¥–æ–±–∞–≤–∏–º hover-–ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ø—Ä–∏—è—Ç–Ω–µ–µ UX)
    if (isPointerFine) {
      document.querySelectorAll('.nav-item.has-dropdown').forEach((item) => {
        const toggleEl = item.querySelector(':scope > .nav-link');
        item.addEventListener('mouseenter', () => {
          closeAll();
          item.classList.add('open');
          toggleEl?.setAttribute('aria-expanded', 'true');
        });
        item.addEventListener('mouseleave', () => {
          item.classList.remove('open');
          toggleEl?.setAttribute('aria-expanded', 'false');
        });
      });
    }
  })();
</script>
